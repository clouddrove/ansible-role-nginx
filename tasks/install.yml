---
# install nginx

- name: Install the nginx package
  apt:
    name: nginx
    state: "{{ state }}"
    update_cache: yes

- name: ensure nginx service is restarted
  service:
    name: nginx
    state: restarted
  changed_when: false

- name: wait for nginx to become ready
  wait_for:
    host: "{{ nginx_bind }}"
    port: "{{ nginx_port }}"
    state: started
    delay: 5
    connect_timeout: 15
    timeout: 300